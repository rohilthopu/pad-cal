<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pad DB</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.min.css">
    <script src="https://use.fontawesome.com/659d3027f8.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.min.css">
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>

    {% load static %}
    <link rel="stylesheet" href="{% static 'css/dataTables.bulma.css' %}">
    <link rel="stylesheet" href="{% static 'css/guerrilladisplay.css' %}">
    <script type="text/javascript" src={% static 'js/dataTables.bulma.js' %}></script>
    <script type="text/javascript" src={% static 'js/monsterdetail.js' %}></script>
    <script type="text/javascript" src={% static 'js/guerrillaswitch.js' %}></script>
</head>

<meta name="viewport" content="width=device-width, initial-scale=1">
<body>

<nav class="navbar is-dark" role="navigation">
    <div class="navbar-brand">
        <span class="navbar-burger burger" onclick="hamburgerHelper();">
            <span></span>
            <span></span>
            <span></span>
        </span>
    </div>
    <div id="navbar-menu" class="navbar-menu">
        <div class="navbar-start">
            <a class="navbar-item" href="/">Pad DB</a>
            <div class="navbar-item has-dropdown is-hoverable">
                <a class="navbar-link" href="/monsterdb/na">
                    Monsters
                </a>

                <div class="navbar-dropdown">
                    <a class="navbar-item" href="/monsterdb/na">
                        NA
                    </a>
                    <a class="navbar-item" href="/monsterdb/jp">
                        JP
                    </a>
                </div>
            </div>
            <div class="navbar-item has-dropdown is-hoverable">
                <a class="navbar-link" href="/dungeons/na">
                    Dungeons
                </a>

                <div class="navbar-dropdown">
                    <a class="navbar-item" href="/dungeons/na">
                        NA
                    </a>
                    <a class="navbar-item" href="/dungeons/jp">
                        JP
                    </a>
                </div>
            </div>
            <div class="navbar-item has-dropdown is-hoverable">
                <a class="navbar-link" href="/activeskills/na">
                    Active Skills
                </a>
                <div class="navbar-dropdown">
                    <a class="navbar-item" href="/activeskills/na">
                        NA
                    </a>
                    <a class="navbar-item" href="/activeskills/jp">
                        JP
                    </a>
                </div>
            </div>
        </div>
    </div>
</nav>

{% block content %}
    <section class="hero is-dark" style="margin-bottom: 2%;">
        <div class="hero-body has-text-centered">
            <div class="container is-fluid">
                <h1 class="title"> Calender </h1>
                <h2 class="subtitle" style="margin-bottom: 0%"> Guerrilla Dungeons for {{ date }}</h2>
                <h2 class="subtitle is-6 is-italic" style="margin-bottom: 0%;"> Dates and Times listed are for Pacific
                    Time (UTC-8).</h2>
                <h2 class="subtitle is-6 is-italic"> Status, ETA, and Time Left are real time figures, irrespective of
                    time zones.</h2>
            </div>
        </div>
    </section>
    <nav class="breadcrumb is-centered" aria-label="breadcrumbs">
        <ul>
            <li class="is-active" id="natab"><a onclick="switchNA();">NA</a></li>
            <li id="jptab"><a onclick="switchJP();">JP</a></li>
        </ul>
    </nav>
    <div class="label has-text-centered">Dungeons are default sorted by Group</div>
    <div class="columns is-centered" style="margin-top: 2%; margin-bottom: 2%;">
        <div class="column is-four-fifths">

            <div id="na">
                <table class="table is-fullwidth is-hoverable" id="natable">
                    <thead>
                    <tr>
                        <th class="has-text-left">Dungeon</th>
                        <th class="has-text-left">Group</th>
                        <th class="has-text-left">Status</th>
                        <th class="has-text-left">ETA</th>
                        <th class="has-text-left">Time Left</th>
                        <th class="has-text-left">Start</th>
                        <th class="has-text-left">End</th>
                        <th class="has-text-left hide" name="time-title" id="nahead">Time</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for dungeon, active in na %}
                        <tr>
                            <td class="has-text-left">{{ dungeon.name }}</td>
                            <td class="has-text-left">{{ dungeon.group }}</td>
                            <td class="has-text-left" name="active">{{ active }}</td>
                            <td class="has-text-left" name="starttime" value="{{ dungeon.startSecs }}"></td>
                            <td class="has-text-left" name="endtime" value="{{ dungeon.endSecs }}"></td>
                            <td class="has-text-left">{{ dungeon.startTime }}</td>
                            <td class="has-text-left">{{ dungeon.endTime }}</td>
                            <td class="has-text-left hide" name="time-mobile" id="naval"></td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>

            <div id="jp" style="display: none">
                <table class="table is-fullwidth is-hoverable" id="jptable">
                    <thead>
                    <tr>
                        <th class="has-text-left">Dungeon</th>
                        <th class="has-text-left">Group</th>
                        <th class="has-text-left">Status</th>
                        <th class="has-text-left">ETA</th>
                        <th class="has-text-left">Time Left</th>
                        <th class="has-text-left">Start</th>
                        <th class="has-text-left">End</th>
                        <th class="has-text-left hide" name="time-title" id="jphead">Time</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for dungeon, active in jp %}
                        <tr>
                            <td class="has-text-left">{{ dungeon.name }}</td>
                            <td class="has-text-left">{{ dungeon.group }}</td>
                            <td class="has-text-left" name="active">{{ active }}</td>
                            <td class="has-text-left" name="starttime" value="{{ dungeon.startSecs }}"></td>
                            <td class="has-text-left" name="endtime" value="{{ dungeon.endSecs }}"></td>
                            <td class="has-text-left">{{ dungeon.startTime }}</td>
                            <td class="has-text-left">{{ dungeon.endTime }}</td>
                            <td class="has-text-left hide" name="time-mobile" id="jpval"></td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>


        </div>

    </div>
    {#    <script type="text/javascript">#}
    {#        $(document).ready(function () {#}
    {#            $('table.table').DataTable({#}
    {#                'pageLength': 25,#}
    {#                'order': [],#}
    {#                'searching': false,#}
    {#                'paging': false,#}
    {#                responsive: true,#}
    {##}
    {#            });#}
    {#        });#}
    {#    </script>#}

    <script>
        window.onload = function () {
            computeTimes();
            setInterval(computeTimes, 5000);
        };

        function computeTimes() {
            var actives = document.getElementsByName('active');
            var starttimes = document.getElementsByName('starttime');
            var endtimes = document.getElementsByName('endtime');
            var mobiletimes = document.getElementsByName('time-mobile');
            var time = Date.now() / 1000;

            for (var i = 0; i < actives.length; i++) {

                var status = actives[i].innerText;

                if (status === "Upcoming") {

                    var startTime = parseFloat(starttimes[i].getAttribute('value'));

                    timeDiff = (startTime - time) / 3600;

                    if ((timeDiff > 0) && (timeDiff < 1)) {
                        starttimes[i].innerText = (timeDiff * 60).toFixed(0) + " Minutes";
                        mobiletimes[i].innerText = (timeDiff * 60).toFixed(0) + " Min";
                    }

                    else if (timeDiff < 0) {
                        starttimes[i].innerText = "";
                        mobiletimes[i].innerText = "";
                        actives[i].innerText = "Active";
                    }

                    else if (timeDiff >= 1) {
                        starttimes[i].innerText = timeDiff.toFixed(0) + " Hours";
                        mobiletimes[i].innerText = timeDiff.toFixed(0) + " Hr";
                    }

                }

                else if (status === "Active") {

                    var endtime = parseFloat(endtimes[i].getAttribute('value'));

                    var timeDiff = (endtime - time) / 60;

                    if (timeDiff > 0) {
                        endtimes[i].innerText = timeDiff.toFixed(0) + " Minutes";
                        mobiletimes[i].innerText = timeDiff.toFixed(0) + " Min";
                    }

                    else {
                        actives[i].innerText = "Ended";
                        endtimes[i].innerText = "";
                        starttimes[i].innerText = "";
                        mobiletimes[i].innerText = "";
                    }
                }
            }
        }
    </script>
{% endblock %}
</body>
</html>
