<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pad DB</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.min.css">
    <script src="https://use.fontawesome.com/659d3027f8.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.min.css">
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>

    {% load static %}
    <link rel="stylesheet" href={% static 'css/dataTables.bulma.css' %}>
    <script type="text/javascript" src={% static 'js/dataTables.bulma.js' %}></script>
    <script type="text/javascript" src={% static 'js/monsterdetail.js' %}></script>
    <script type="text/javascript" src={% static 'js/guerrillaswitch.js' %}></script>
</head>

<meta name="viewport" content="width=device-width, initial-scale=1">
<body class="has-navbar-fixed-top">

<nav class="navbar is-dark is-fixed-top" role="navigation">
    <div class="navbar-brand">
        <span class="navbar-burger burger" onclick="hamburgerHelper();">
            <span></span>
            <span></span>
            <span></span>
        </span>
    </div>
    <div id="navbar-menu" class="navbar-menu">
        <div class="navbar-start">
            <a class="navbar-item" href="/">Pad DB</a>
            <div class="navbar-item has-dropdown is-hoverable">
                <a class="navbar-link" href="/monsterdb/na">
                    Monsters
                </a>

                <div class="navbar-dropdown">
                    <a class="navbar-item" href="/monsterdb/na">
                        NA
                    </a>
                    <a class="navbar-item" href="/monsterdb/jp">
                        JP
                    </a>
                </div>
            </div>
            <div class="navbar-item has-dropdown is-hoverable">
                <a class="navbar-link" href="/dungeons/na">
                    Dungeons
                </a>

                <div class="navbar-dropdown">
                    <a class="navbar-item" href="/dungeons/na">
                        NA
                    </a>
                    <a class="navbar-item" href="/dungeons/jp">
                        JP
                    </a>
                </div>
            </div>
            <div class="navbar-item has-dropdown is-hoverable">
                <a class="navbar-link" href="/activeskills/na">
                    Active Skills
                </a>
                <div class="navbar-dropdown">
                    <a class="navbar-item" href="/activeskills/na">
                        NA
                    </a>
                    <a class="navbar-item" href="/activeskills/jp">
                        JP
                    </a>
                </div>
            </div>
        </div>
    </div>
</nav>

{% block content %}
    <section class="hero is-dark" style="margin-bottom: 25px; width: 100%">
        <div class="hero-body has-text-centered">
            <div class="container is-fluid">
                <h1 class="title"> Calender </h1>
                <h2 class="subtitle" style="margin-bottom: 0%"> Guerrilla Dungeons for {{ date }}</h2>
                <h2 class="subtitle is-6 is-italic"> Dates and Times listed are for Pacific Time (UTC-8).</h2>
            </div>
        </div>
    </section>
    <nav class="breadcrumb is-centered" aria-label="breadcrumbs">
        <ul>
            <li class="is-active" id="natab"><a onclick="switchNA();">NA</a></li>
            <li id="jptab"><a onclick="switchJP();">JP</a></li>
        </ul>
    </nav>
    <div class="label has-text-centered">Dungeons are default sorted by Group</div>
    <div class="columns is-centered" style="margin: 2%">
        <div class="column is-two-thirds" id="na">
            <table class="table is-fullwidth is-hoverable" id="natable">
                <thead>
                <tr>
                    <th class="has-text-left">Dungeon</th>
                    <th class="has-text-right">Group</th>
                    <th class="has-text-right">Status</th>
                    <th class="has-text-right">ETA</th>
                    <th class="has-text-right">Time Left</th>
                    <th class="has-text-right">Start</th>
                    <th class="has-text-right">End</th>
                </tr>
                </thead>
                <tbody>
                {% for dungeon, active in na %}
                    <tr>
                        <td class="has-text-left">{{ dungeon.name }}</td>
                        <td class="has-text-right">{{ dungeon.group }}</td>
                        <td class="has-text-right" name="active">{{ active }}</td>
                        <td class="has-text-right" name="starttime" value="{{ dungeon.startSecs }}"></td>
                        <td class="has-text-right" name="endtime" value="{{ dungeon.endSecs }}"></td>
                        <td class="has-text-right">{{ dungeon.startTime }}</td>
                        <td class="has-text-right">{{ dungeon.endTime }}</td>
                    </tr>

                {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="column is-two-thirds" id="jp" style="display: none">
            <table class="table is-fullwidth is-hoverable" id="jptable">
                <thead>
                <tr>
                    <th class="has-text-left">Dungeon</th>
                    <th class="has-text-right">Group</th>
                    <th class="has-text-right">Status</th>
                    <th class="has-text-right">ETA</th>
                    <th class="has-text-right">Time Left</th>
                    <th class="has-text-right">Start</th>
                    <th class="has-text-right">End</th>
                </tr>
                </thead>
                <tbody>
                {% for dungeon, active in jp %}
                    <tr>
                        <td class="has-text-left">{{ dungeon.name }}</td>
                        <td class="has-text-right">{{ dungeon.group }}</td>
                        <td class="has-text-right" name="active">{{ active }}</td>
                        <td class="has-text-right" name="starttime" value="{{ dungeon.startSecs }}"></td>
                        <td class="has-text-right" name="endtime" value="{{ dungeon.endSecs }}"></td>
                        <td class="has-text-right">{{ dungeon.startTime }}</td>
                        <td class="has-text-right">{{ dungeon.endTime }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{#    <script type="text/javascript">#}
{#        $(document).ready(function () {#}
{#            $('table.table').DataTable({#}
{#                'pageLength': 25,#}
{#                'order': [],#}
{#                'searching': false,#}
{#                'paging': false,#}
{#                responsive: true,#}
{##}
{#            });#}
{#        });#}
{#    </script>#}

    <script>
        window.onload = function () {
            computeTimes();
            setInterval(computeTimes, 5000);
        };
        function computeTimes() {
            var actives = document.getElementsByName('active');
            var starttimes = document.getElementsByName('starttime');
            var endtimes = document.getElementsByName('endtime');
            var time = Date.now() / 1000;

            for (var i = 0; i < actives.length; i++) {

                var status = actives[i].innerText;

                if (status === "Upcoming") {

                    var startTime = parseFloat(starttimes[i].getAttribute('value'));

                    timeDiff = (startTime - time) / 3600;

                    if ((timeDiff > 0) && (timeDiff < 1)) {
                        starttimes[i].innerText = (timeDiff * 60).toFixed(2) + " Minutes";
                    }

                    else if (timeDiff < 0) {
                        starttimes[i].innerText = "";
                        actives[i].innerText = "Active";
                    }

                    else if (timeDiff >= 1) {
                        starttimes[i].innerText = timeDiff.toFixed(1) + " Hours";
                    }

                }

                else if (status === "Active") {

                    var endtime = parseFloat(endtimes[i].getAttribute('value'));

                    var timeDiff = (endtime - time) / 60;

                    if (timeDiff > 0) {
                        endtimes[i].innerText = timeDiff.toFixed(2) + " Minutes";
                    }

                    else {
                        actives[i].innerText = "Ended";
                        endtimes[i].innerText = "";
                        starttimes[i].innerText = "";
                    }
                }
            }
        }
    </script>
{% endblock %}
</body>
</html>
